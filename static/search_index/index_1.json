{"/projects/index.html":{"title":"Emoe R&D项目主页","content":" title: Emoe R&D项目主页 keywords: false desc: Emoe R&D项目页 date: false 这里陈列了Emoe R&D的产品文档，请在左侧导航栏选择查看"},"/projects/EmoeDAQ/emoedaq-manual.html":{"title":"EmoeDAQ 用户手册","content":" title: EmoeDAQ 用户手册 keywords: EmoeDAQ desc: EmoeDAQ 用户手册 author: Floydfish date: false tags: analog, emoedaq # EmoeDAQ 用户手册 > 硬件版本： 1.4.0 > 手册版本： 1.0.5 > 最后更新时间： 2025 03 27 ## 快速开始指南 ### 连接输入信号 单端测量 将要使用的通道的IN 连接到GND，从IN+和另一个GND接入信号 差分测量 将GND连接到待测设备的GND，IN+和IN 分别接入待测设备的差分输出 输入短路测试 将CH1的IN+、IN 与GND连接（4个接线端子全部短接） ### 连接选件 使用牛角座+排线插头连接外部选件，如果需要测量外部温度，需要连接外部测温传感器TMP117，TMP117的ADDR必须连接到VCC（对应I2C地址0x49，0x48被板上温度传感器占用） ### 连接电脑 1. 请确保PC的USB端口供电能力足够，不推荐连接到没有外部供电的劣质拓展坞上。 2. 使用USB TypeC数据线连接PC和DAQ，查看电脑的USB设备列表，应有**USB串行设备(COM*)** 3. 打开串口助手，选择DAQ的端口号，波特率可从9600至921600之间随意选择，打开端口，发送命令：*IDN?（**附带换行，换行符为\\n**），查询设备型号以及版本号 4. 发送命令：MEAS:VOLT:DC? 1 （**附带换行，换行符为\\n**）以查询CH1的输入电压值。注意冒号为英文字符，切勿使用中文输入法。 ### 连接示例上位机 1. 下载EmoeDAQ **[上位机](https://github.com/emoestudio/EmoeDAQ)**(Release界面，若无法访问github，可在R&D交流群群文件获取) 2. 运行，选择端口号以及波特率，点击连接 3. 启动CHx为单通道连续测量，启动扫描为2个输入通道切换扫描测量 4. 设置NPLC可改变数据更新速率，但也会改变DAQ的测量本底噪声。NPLC越高，噪声越低。 5. 波形窗口视图可开启直方图和FFT分析，但需要注意直方图需要一定数据点积累后才能显示，FFT分析需要采集到足够多的数据点 6. FFT设置可调整FFT窗函数、FFT数据点数、以及幅度范围 7. 显示控制窗口可控制采样的波形长度，默认为1w点，最大可调整至10w点。Y轴范围默认开启自动调节，也可手动指定 8. 清空数据将清空采样buffer内所有数据，表头显示数据，波形曲线数据，以及统计数据 9. 保存数据可以将2个通道的采样数据保存为csv文件 10. 右键波形窗口可以选择Export，将波形导出为图片、svg等格式 ## DAQ控制指令集 EmoeDAQ采用SCPI指令集与上位机通过串口进行通讯。 DAQ的SCPI指令集可以分为几类，分别是： IEEE 488.2标准命令 DAQ硬件配置命令 DAQ采样控制命令 DAQ系统命令 SCPI指令集的简写为指定的单词开头（大写），比如 `CONFigure:VOLTage:DC:NPLCycles 10` 这句可以简写为 `CONF:VOLT:DC:NPLC 10`。 同时，SCPI标准指定的换行符为 LF(\\n)。部分串口助手软件中默认的换行符为\\r\\n，推荐更改为 LF(\\n)。 ### IEEE 488.2标准命令 #### *RST 格式：***RST** 功能：复位EmoeDAQ，使其硬件重新初始化 详细解释：接收到该命令后，DAQ会进行上电初始化操作。重新初始化后，DAQ进入出厂配置的默认工作状态 示例：*RST 返回值：\"system boot complete\" #### *IDN? 格式：***IDN?** 功能：查询仪器ID信息 详细解释：接收到该命令后，设备返回仪器型号，以及软件版本号等信息 示例：*IDN? 返回值：仪器型号，以及软硬件版本号等信息 #### *CLS 格式：***CLS** 功能：清除错误信息 详细解释：接收到该命令后，设备将清除累积的SCPI错误信息 示例：*CLS 返回值：无 其他指令请参考IEEE488.2规范内容 ### DAQ采样控制命令 #### 单次测量电压 格式：**MEASure:VOLTage:DC? {12}** 功能：测量指定通道的电压 详细解释：用该命令触发DAQ对某一通道进行采样，采样的积分时间取决于目前的系统设置。支持AutoZero功能，**需要注意，在开启AutoZero功能时，实际转换时间将加倍。** 示例：MEASure:VOLTage:DC? 1 或 MEAS:VOLT:DC? 1 返回值：对应通道的电压值 #### 单次测量电压，附带外部温度 **该指令需要连接外部测温传感器TMP11，否则温度数据为0** 格式：**MEASure:VOLTage:DC:TEMPerature? {12}** 功能：测量指定通道的电压，以及当前DAQ内部温度值 详细解释：用该命令触发DAQ对某一通道进行采样，采样的积分时间取决于目前的系统设置。支持AutoZero功能，**需要注意，在开启AutoZero功能时，实际转换时间将加倍。**。输出电压的同时，还会输出DAQ内部的温度。该指令适合长期监测时使用，测量电压的同时测量DAQ内部温度 示例：MEASure:VOLTage:DC:TEMPerature? 1 或 MEAS:VOLT:DC:TEMP? 1 返回值：对应通道的电压值，以及当前DAQ内部温度，两个数据以','分隔 #### 单次测量通道间电压比例 格式：**MEASure:VOLTage:RATio? {12}** 功能：测量2个通道间的电压值比例 详细解释：用该命令触发DAQ进行单次采样，分别测量通道1和通道2的电压值（支持AutoZero），然后计算出2个通道间的电压比例。**命令的参数为比例计算中的分子** ——即当命令的参数为1时，返回比例值为 (Volt1 / Volt2)；当命令参数为2时，返回比例值为 (Volt2 / Volt1) 示例：MEAS:VOLT:RATio? 1 返回值：2个通道的电压比例值，保留8位小数 #### 设置采样积分周期 格式：**CONFigure:VOLTage:DC:NPLCycles {0.10.250.5110100}** 功能：配置DAQ采样的积分时间 **(Number of PowerLine Cycles)** 详细解释：用该命令设置DAQ采样的积分时间，积分时间越长，输出数据的噪声越低，电压有效位数越高。积分时间计算是依据工频电源周期数决定的，比如NPLC 10时，积分10个工频周期。假设市电频率是50Hz，周期20ms，那么10NPLC 200ms，对应5SPS/s的数据更新速率。**需要注意，在开启AutoZero功能时，实际采样率将减半。** 示例：CONFigure:VOLTage:DC:NPLCycles 100 返回值：无 #### 查询采样积分周期 格式：**CONFigure:VOLTage:DC:NPLCycles?** 功能：查询DAQ采样的积分周期 **(Number of PowerLine Cycles)** 详细解释：用该命令查询DAQ采样的积分周期，积分周期越多，输出数据的噪声越低，电压有效位数越高。**需要注意，在开启AutoZero功能时，实际采样率将减半。** 示例：CONFigure:VOLTage:DC:NPLCycles? 返回值：返回当前DAQ的采样积分周期 #### 设置DAQ连续采样 格式：**CONFigure:CONTinuous:READ {12},{ONOFF}** 功能：设置DAQ的采样模式为单次（关闭CONT）或连续（开启CONT） 详细解释：用该命令设置DAQ的采样模式，某通道在单次采样模式下，DAQ只有接收到触发信号时才会采样并输出数据（触发信号来自SCPI指令）；某通道在连续转换模式下，DAQ将自动按照设置的NPLC进行连续转换并输出数据。请注意，同时只有一个通道能被激活连续转换模式。如果需要2个通道同时连续转换，请使用扫描模式。 示例：CONFigure:CONTinuous:READ 1,ON 返回值：无，但如果激活连续转换，随后紧跟对应的DAQ采样的数据 #### 设置DAQ扫描采样 格式：**CONFigure:CONTinuous:SCAN {ONOFF}** 功能：设置DAQ的采样模式为扫描转换 详细解释：用该命令设置DAQ为连续扫描转换模式，该模式下DAQ先对CH1进行转换，然后对CH2进行转换，最后依次、同时输出2个通道的电压值。 示例：CONFigure:CONTinuous:SCAN ON 返回值：无，但如果激活连续扫描转换，随后紧跟对应的DAQ采样的数据 #### 设置AutoZero AZ功能仅能消除内部信号链的失调误差，内部采用恒温设计后，AutoZero功能可以不使用。 格式：**CONFigure:AutoZero:DC {ONOFF}** 功能：设置DAQ采样的自动校零功能 详细解释：用该命令设置DAQ的自动校零功能，AutoZero开启时，DAQ先测量信号链自身的失调电压，然后再测量输入信号电压，最后输出失调矫正过的数据。该模式仅对单次转换、单通道连续转换适用，暂不支持扫描转换。开启AutoZero后，对应的转换速率减半。（**该功能不能消除外部热电势影响**） 示例：CONFigure:AutoZero:DC ON 返回值：无 ### DAQ硬件配置命令 #### 查询DAQ系统设置 格式：**CONFigure:INFormation?** 功能：查询DAQ当前的系统设置 详细解释：用该命令查询DAQ的系统设置，包括 **波特率（仅使用USART接口的固件支持）** (带外壳的DAQ使用USB VCP通信，无需设置波特率)、NPLC频率、NPLC周期数、AutoZero是否开启 示例：CONFIGURE:INFormation? 返回值：波特率、NPLC频率、NPLC周期数、AutoZero是否开启 #### 设置内部加热恒温温度 格式：**HEAT:TEMP {temperature}** 功能：设置内部加热恒温温度 详细解释：用该命令设置内部加热恒温温度，单位为摄氏度，温度范围为20 42度，**该温度值会保存在EEPROM中**，重启后仍然有效。**推荐设置温度为35度**，DAQ的出厂校准温度也是35度。 示例：HEAT:TEMP 35 返回值：提示温度设定值已更新 #### 查询内部加热恒温温度 格式：**HEAT:TEMP?** 功能：查询内部加热恒温温度 详细解释：用该命令查询内部加热恒温温度，单位为摄氏度，温度范围为20 42度。 示例：HEAT:TEMP? 返回值：加热恒温温度设定值 ### DAQ系统命令 #### 测量板上温度 格式：**MEASure:INTernal:TEMPerature?** 功能：测量DAQ当前的板上温度 详细解释：用该命令激活板上温度传感器，测量基准和ADC附近的温度值，返回给用户。 示例：MEASure:INT:TEMP? 返回值：板上温度，保留3 4位小数 #### 测量外部温度 格式：**MEASure:EXTernal:TEMPerature?** 功能：测量外部连接的TMP117传感器温度数据 详细解释：用该命令测量外部温度传感器，**传感器的地址管脚必须连接到VCC**（I2C地址固定为0x49，地址0x48被板上温度传感器占用），测量外部温度值，返回给用户。 示例：MEASure:EXT:TEMP? 返回值：外部温度，保留3 4位小数 #### 灯光指示 格式：**SYSTem:IDENtify** 功能：闪烁后面板的ERR指示灯 详细解释：闪烁后面板的ERR指示灯，用于指示当前收到指令的DAQ。在连接多个DAQ时用于区分DAQ。DAQ收到该命令后，背板上的蓝色ERR指示灯将闪烁5次，间隔时间1秒。 示例：SYSTem:IDEN 返回值：无 #### 用户增益校准 格式: SYSTem:CALibration:GAIN {gain} 功能：写入DAQ的系统增益,并保存 详细解释： 写入DAQ的系统增益,该增益是线性回归拟合校准得出的增益误差,在DAQ内部参与电压转换的计算,补偿DAQ的系统增益误差 示例：SYSTem:CAL:INL:SLOPE 1.00032855 返回值：写入的增益值,并提示保存成功与否 #### 查询用户增益校准系数 格式: SYSTem:CALibration:GAIN? 功能：查询增益校准系数 详细解释： 查询DAQ内部存储的增益校准系数 示例：SYSTem:CAL:GAIN? 返回值：1.00032855 #### 用户失调校准 格式: SYSTem:CALibration:OFFSET {offset} 功能：写入DAQ的系统失调误差,并保存 详细解释： 写入DAQ的系统失调误差,该增益是线性回归拟合校准得出的失调误差,在DAQ内部参与电压转换的计算,补偿DAQ的系统失调误差 示例：SYSTem:CAL:INL:INT 0.00003882 返回值：写入的失调值,并提示保存成功与否 #### 查询用户失调校准系数 格式: SYSTem:CALibration:OFFSET? 功能：查询失调校准系数 详细解释： 查询DAQ内部存储的失调校准系数 示例：SYSTem:CAL:OFFSET? 返回值：0.00003882 #### ADC系统校准 格式: SYSTem:CALibration:ADC 功能：执行ADC系统校准 详细解释： 该功能执行的是ADC片内自带的校准程序,分别给ADC输入通入0V和VREF,以此来计算ADC前面所有信号链的失调和增益误差.但此方法由于ADC的INL限制,效果有限.如果需要高精度,还是需要高位表+源来校准标定.该过程需要约20秒的时间完成,且需要在DAQ充分预热且环境温度较稳定的情况下进行 示例：SYSTem:CAL:ADC 返回值：校准前的增益\\失调寄存器,与校准后的增益\\失调寄存器 #### 写入校准日期 格式: SYSTem:CALibration:DATE 功能：写入校准日期 详细解释： 写入校准日期,格式是: yyyy,mm,dd 示例：SYST:CAL:DATE 1919,8,10 返回值：无 #### 存储ADC系统校准数据 格式: SYSTem:CALibration:STORE 功能：保存ADC系统校准数据,以及校准日期 详细解释： 保存ADC系统校准数据,以及校准日期 示例：SYST:CAL:STORE 返回值：保存成功以及校准数据明细,如果有未执行的校准项将提示校准未完成 #### 擦除校准数据 格式: SYSTem:CALibration:DEFAULT 功能：擦除所有校准数据 详细解释： 擦除所有校准数据,包括ADC系统校准寄存器\\手动输入的增益失调误差\\校准日期等 示例：SYST:CAL:DEFAULT 返回值：校准数据复位成功 #### 查询所有校准数据 格式: SYSTem:CALibration:INFormation? 功能：查询校准数据 详细解释： 查询所有校准数据,包括ADC系统校准寄存器\\手动输入的增益失调误差\\校准日期等 示例：SYST:CAL:INF? 返回值：有效校准数据,若未执行过校准/校准数据被擦除,则提示校准数据不存在 #### 系统固件升级 格式: SYSTem:Update 功能：使DAQ进入升级模式 详细解释： 该命令将解除DAQ初始化，使其进入DFU(Device Firmware Upgrade)模式。在此模式下，通过STM32CubeProgrammer连接DAQ，可以对其进行固件升级。 示例：SYSTem:Update 返回值：无，命令执行后，USB端口立刻断开连接。 ## DAQ校准原理 请参考Emoe上的文章 **[EmoeDAQ 高精度数据采集器 下篇](https://www.emoe.xyz/emoedaq design 2/#5)** 中的第五节 校准原理 ## 校准说明 校准的本质是将DAQ的绝对精度调整到与参考表的精度较为一致的水平，所以，**决定校准后精度的是参考表的精度**。 如果需要绝对的精确度，那就需要绝对精确的参考表，比如短期内经过约瑟夫森结传递校准过的Keysight 3458A DMM 或 Fluke的高位Calibrator。 ## DAQ校准流程 ### 校准所需要的设备 DAQ的直流精度超过 5½ 数字万用表，所以至少需要 6½ 的数字万用表作为校准参考表。同时还需要一个低噪声、极稳定的可调节直流源，如果校准源的噪声较高或漂移较大，会增大校准过程中的不确定性，导致校准精度不及预期。推荐设备如下： Keysight 34465A或同等级、甚至更高等级的台式DMM 5位半以上的DC源表，能够产生 5V至+5V的可调电压输出 铜芯线用于连接 ### 推荐校准流程 自动版 如果有可连接至PC的DMM和源表，且能被VISA识别到，可以使用python来完成自动化校准。 🐟使用的是 Keysight 34465A+横河7651，DMM使用USB连接，7651使用GPIB连接。 0. 将DAQ连接到电脑，发送指令 **HEAT:TEMP 35** 设定内部恒温温度，此数值将作为校准时的温度保存到校准数据中。 1. 将源表输出连接到DAQ的CH1输入端（DAQ的INN接地，INP连接源表输出正极）和DMM的电压输入端 2. 使用稳定且足功率的USB端口连接DAQ，通电静置至少半小时让DAQ和其他仪器充分稳定，DMM与源表同步上电静置。 3. 测试VISA连接DMM与源表，能否正常通信，根据自己的设备修改相应的SCPI控制指令 4. 修改校准程序的校准日期等内容，运行自动化校准程序，完成校准 5. 打开串口助手，连接DAQ，查询校准结果是否正确 ### 手动校准 如果上述自动校准条件不具备，可以使用手动校准的方式。**不过需注意，无论是哪种校准方式都需要一台高位DMM，以及一个低噪声且稳定可调的电压源。** 为达到最佳校准精度，推荐使用多点校准拟合的方式来得出增益与失调系数。 DAQ的手动校准分为2步，分别是ADC系统校准和用户自定义比对参考表校准。下面给出一个示例： 0. 将DAQ连接到电脑，发送指令 **HEAT:TEMP 35** 设定内部恒温温度，此数值将作为校准时的温度保存到校准数据中。 1. 使用稳定且足功率的USB端口连接DAQ，通电静置至少半小时让DAQ和其他仪器充分稳定，DMM与源表同步上电静置。 2. 将DAQ连接串口助手，手动发送指令 **\"SYST:CAL:ADC\"** 执行ADC的系统校准，等待20秒输出结果； 3. 手动发送指令 **\"SYST:CAL:DATE 2025,1,14\"** ，写入校准的日期 4. 手动发送指令 **\"SYST:CAL:STORE\"** ，保存ADC系统校准数据 5. 将源表输出连接到DAQ的CH1输入端（DAQ的INN接地，INP连接源表输出正极）和DMM的电压输入端 6. 调整源表输出至 4.9V，等待DAQ和DMM读数稳定后记录数值，填入Excel表格 7. 重复上述操作，使源表分别输出 4.9V、 4V、 3V、 2V、... 0V、... 、+4V、+4.9V，记录数据 8. 在Excel中将DMM读数和DAQ读数整理为2列，然后根据这些数据计算一次线性回归系数（可以调用Excel的函数功能） 9. 得到校准系数后，将DAQ连接串口助手，通过校准指令 **\"SYST:CAL:GAIN 1.00002243123\"、\"SYST:CAL:OFFSET 0.000004232\"**手动写入DAQ（此处数字仅示例） 10. 发送指令 **\"SYST:CAL:INF?\"** 查询校准数据是否正确"},"/projects/EmoePulse/emoepulse.html":{"title":"Emoe Pulse Lite V2 用户手册","content":" title: Emoe Pulse Lite V2 用户手册 keywords: analog desc: Emoe Pulse Lite V2 用户手册 author: CNPP date: false tags: analog, emoepulse # Emoe Pulse Lite V2 用户手册 ![0 1](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/0 1.JPG) > 硬件版本： 2.1 > 手册版本： 1.0 ## 1. 简介 Emoe Pulse Lite（下简称Pulse）是一款超低功耗的便携高速窄脉冲发生器，用于一定范围内的带宽测量及线缆检测。Pulse 的电路衍生自Jim Williams于[LT AN47](https://www.analog.com/media/en/technical documentation/application notes/an47fa.pdf)等参考手册中发布的雪崩脉冲发生电路，如下图： ![1 1](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 1.png) Pulse对Jim的设计进行了低功耗方向的优化，采用了雪崩击穿电压更低的射频三极管，并设计了超低功耗的DC DC系统，使得整机可以在一片CR2032的供电下稳定工作较长时间。同时，Pulse亦可选择使用Type C接口供电，两种供电方式通过开关选择，在通过Type C接口供电时不需取下电池。 ![1 2](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 2.JPG) ## 2. 主要指标 注意：由于Pulse电路的脉冲振荡受可调电容C影响，以下参数仅供参考。 项目参数 Type C接口供电电压范围4.5 5.5V CR2032电池座供电电压范围2.5 3.1V 上升时间< 350ps 脉冲峰值@50Ohm0.8V 脉冲峰值@1MOhm1.2V 脉冲重复频率200kHz 工作电流@3.0V750uA 经Keysight DSAV334A 33GHz 80Gsa/s 测试的脉冲参数： ## 3. 使用方法 首先应该将包装中的CR2032电池装入Pulse背面的电池座： ![1 3 0](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 3 0.jpg) 或接入5V供电的Type C线缆。开关拨至`BAT`处，Pulse由电池供电；拨至对侧则为Type C接口供电。 Pulse的主要功能为单一窄脉冲源或线缆测试仪。Pulse拥有两个对称的**输出**端口，在作为单一窄脉冲源时，应在不用的端口装上附带的50Ohm负载帽。脉冲输出端口与待测端口连接时，应根据需要加入50Ohm匹配器，下图展示了使用Pulse测试示波器的模拟输入带宽： ![1 3](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 3.JPG) 在以较大水平时间观察时，示波器应显示如下的窄脉冲串： ![1 4](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 4.JPG) 在设置好触发电平后将水平时间减小至5ns/div左右，可观察窄脉冲及上升时间： ![1 5](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 5.JPG) 当将Pulse作为线缆测试仪使用时，应将一端口紧贴示波器安装，另一端口接待测线缆。下图展示了测试开路传输线的效果： ![1 6](https://cnpp image.oss cn beijing.aliyuncs.com/emoe_rd_project/cnpp_01_emoe_pulse/emoe_pulse_lite_v2_1/img/1 6.JPG) ## 参考链接 + Application Note 47, High Speed Amplifier Techniques: <https://www.analog.com/media/en/technical documentation/application notes/an47fa.pdf> + Application Note 94, Slew Rate Verification for Wideband Amplifiers: <https://www.analog.com/media/en/technical documentation/application notes/an94f.pdf> ## 鸣谢 + @FloydFish的测试与线上手册支持 + @HAIDERdunk的33GHz示波器测试支持 ## 修订历史 日期版本说明 2024 01 281.0首次发布 2024 03 021.1增加了电池安装方法图以及上升沿测试图 ## 购买 如果需要购买，请扫码加入Emoe R&D交流群获取货品备货信息： <center> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/Common%20Resource/erd_qrcode.jpg\" alt \"baidu\" width 50% border \"0\"/> </center>"},"/projects/EmoeNAP/emoenap.html":{"title":"EmoeNAP 用户手册","content":" title: EmoeNAP 用户手册 keywords: analog desc: EmoeNAP 用户手册 author: Floydfish date: false tags: analog, emoenap # EmoeNAP 用户手册 ![EmoeNAP](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/P2.jpg) > 硬件版本： 1.1 > 手册版本： 1.0 ## 货品清单 EmoeNAP主机一台 EmoeNAP CalKit PCBA一套 SMA短路帽一个（安装在输入端口上） SMA防尘帽3个（安装在输出端口上） ## 购买 如果需要购买，请扫码加入Emoe R&D交流群获取货品备货信息： <center> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/Common%20Resource/erd_qrcode.jpg\" alt \"baidu\" width 50% border \"0\"/> </center> ## 简介 **EmoeNAP** 是一款超低噪声、高增益、高带宽的低噪声交流信号放大器，非常适合用于LDO、基准电压源芯片、运算放大器等模拟器件/电路的输出噪声测试。EmoeNAP的设计改进自 Linear Technology的 **[AN 159:Measuring 2nV/√Hz Noise and 120dB Supply Rejection on Linear Regulators](https://www.analog.com/en/app notes/an 159.html)**。 AN 159中使用了4个 **THAT300** 四单元匹配晶体管对。一对晶体管作为运放的差分输入级，同一封装内的4个晶体管两两并联，然后再将4个单独的放大器单元用反向加法器等比例相加，达到平均降噪的效果。 相较于原设计，EmoeNAP使用了超低电压噪声的运算放大器，同样通过多通道并联来实现超低噪声性能。在兼顾性能的同时还降低了电路面积和成本。同时对于后面的第二、第三放大级，以及有源滤波部分做了部分改进： 将第二个高通RC的电容减小10倍，R增大10倍，以减小电容空间和成本 将输出级的高通RC电容减小10倍，R增大10倍，以减小输出级运放的功耗（原设计带50R负载，改进后带510R负载），同时减小电容体积和成本 改进电源部分，使用2节锂电池+虚拟地电路产生平衡正负电源（如果有成熟的BMS系统，可使用更多电池串联，以拓展系统动态范围），配有带电压均衡的2S升压充电器，通过Type C接口输入5V1A即可充电。原设计使用不可充电电池，在2023年有点不环保了（bushi EmoeNAP的主要指标与特点如下： 10Hz 100kHz带宽输入底噪：176nVrms，源阻抗为0时，折合输入电压噪声谱密度为0.56nV/√Hz（未经过带宽修正，带宽修正后将更小） 增益固定为80dB，可定制60dB增益（也可自行修改） 3个输出带宽，分别为10Hz 100kHz、10Hz 1MHz、10Hz 2.5MHz 典型输出动态范围8Vpp（满电状态下） 输出阻抗：47Ω(典型值) 电池供电，适合悬浮测试，消除接地环路噪声耦合 ![EmoeNAP](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/P1.jpg) ## 外观 输入侧，从左到右依次是：电子文档二维码、电源开关、输入SMA接口、USB C充电口、电源状态指示灯 ![EmoeNAP](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/P3.jpg) 输出侧，从左到右依次为宽带（10Hz 2MHz）、10Hz 1MHz、10Hz 100kHz带宽的输出SMA接口 ![EmoeNAP](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/P4.jpg) ## 使用方法及注意事项 ### 充电 **此设备只能在非工作状态下进行充电。** 首先将EmoeNAP的开关拨至OFF（右侧），找一个能提供5V1A输出能力的USB口，以及一根USB TypeC数据线，接上EmoeNAP输入侧的C口，为EmoeNAP充电。 充电过程中，红色指示灯常亮（CHRG），充满电后红色指示灯熄灭。如果电池异常，红色指示灯将闪烁，**此时建议将设备拆开检查**。 ### 正常工作状态 **此设备在工作状态下，不可接入USB电源，否则充电电路将带来严重的噪声干扰** 将EmoeNAP的开关拨至ON（左侧），绿色指示灯亮起（WORK），此时设备处于正常工作状态。如果电池电量过低，会自动触发电池保护功能，此时工作指示灯也将熄灭。 ### 接入输入信号 请使用SMA同轴线连接到DUT进行测试。（🐟建议在DUT使用IPEX座子，配合IPEX转SMA测试线缆，非常方便）。 同时应注意，应尽量使用同轴线缆/屏蔽线缆作为输入线，**如果输入线缆有任何未屏蔽的部分，都可能引入额外噪声和干扰**。 ### 输入信号范围 EmoeNAP的增益极高，输入1mVpp的交流信号就将导致输出饱和，所以 **请谨慎决定使用EmoeNAP的场合！！** 输入级耦合电容的耐压为16V，**建议输入信号的直流成分不超过12V**，否则有损坏的风险。 短时间内为EmoeNAP输入大电压不会损坏，但会增加功耗。不建议对EmoeNAP输入施加 **800uVpp** 以上的大信号。 ### 输出到示波器 输出端的输出阻抗为47R，此电阻串联在opamp输出，是用于防止opamp输出带大容性负载振荡的。如果将输出连接至示波器，请设置示波器为1MΩ输入阻抗，并设置DC耦合。（NAP输出本身就是交流耦合，不存在DC成分） 测量噪声时，应选择测量项为 **交流有效值（AC.RMS）**。 ### 输出到DMM 常见DMM的交流档带宽都在300kHz左右，所以只有10Hz 100kHz带宽输出接到DMM，能获得可信的测量结果。 DMM的交流档输入是高阻输入，无需设置输入阻抗。 ### 输出到自定义设备 只需要保持设备的输入阻抗为100kΩ以上，输入电容不要太大即可。 如果必须使用50Ω输入阻抗，请注意电压分压比换算（在50Ω终端电阻上得到约0.5倍输出电压） ### 应用EmoeNAP CalKit 由于EmoeNAP的增益极高，输入1mVpp的正弦信号，输出就会直接饱和（80dB增益放大后理论上将输出10Vpp，但由于NAP的供电最高只有8.4V，且运放输出摆幅离电源轨约有百mV压差，无法无失真输出10Vpp信号） 为了方便增益校准、测试与验证，🐟设计了配套的EmoeNAP CalKit。 其实非常简单，就是拼凑合适阻值的电阻，然后用拨码开关去选择切换衰减档位。 <center> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/7.jpg\" width \"80%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/8.jpg\" width \"80%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/9.jpg\" width \"80%\" border \"0\"/> </center> 输入信号是交流信号，那么在通带内我们可以忽略输入耦合电容，将其视作短路，EmoeNAP的有效输入电阻是RL 499R。通过RATT与RL（RIN）分压，可以在放大器输入端得到一个较小的信号。 那么只需要选择RATT为499R、4.5k、49.5k、499.5k，就可以实现6dB、20dB、40dB、60dB的衰减值。 ### 增益验证与校准 准备一台幅度准确的信号源，一台示波器/高精度DMM，以及EmoeNAP CalKit。 设置信号源输出20mVrms、频率10kHz的正弦信号，连接到EmoeNAP CalKit上，设置CalKit衰减为40dB，在EmoeNAP输入端可得到200uVrms的交流信号。 然后将EmoeNAP的10Hz 100kHz输出端接到示波器输入端，设置示波器DC耦合，1MΩ输入阻抗，开启AC.RMS测量项，调整波形合适，此时输出真有效值应该为2Vrms。 如果输出离2Vrms偏离较大，可以调整电路板上的Gain TRIM电位器，调整幅度至2Vrms，即可完成增益校准。 如果示波器精度不高，可以用DMM的交流档交叉验证测试结果。 ### 测试注意事项 尽量不要让输入端接有任何陶瓷电容，陶瓷电容受到任何震动都会产生噪声电压，破坏测量结果。如果不能没有，请做好隔震措施再测试 尽量不要在DUT和EmoeNAP输入端之间串联电阻，任何电阻值都会算入DUT的输出阻抗（源阻抗），使得EmoeNAP的本底噪声抬高，微弱信号测量时可能导致较大误差。 EmoeNAP适合低输出阻抗的DUT测试，不适用于高源阻抗型DUT测试。**源阻抗较高时，电流噪声将主导设备的底噪，使得测试结果不可用**。 ## 性能测试与表征 ### 滤波器带宽测试 100kHz带宽的典型bode响应如下(由于增加了40dB衰减，所以测试出的增益为40dB)： ![100kHz_Variation](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/100k.jpg) 1MHz带宽的典型bode响应如下(由于增加了40dB衰减，所以测试出的增益为40dB)： ![1MHz_Variation](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/1M.jpg) 抽取6个样本，测试100kHz带宽的低通滤波器响应： ![100kHz](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/1.jpg) 抽取6个样本，测试1MHz带宽的低通滤波器响应(由于高频段输出幅度太小，示波器无法准确测量rms值，故有较大起伏)： ![1MHz](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/emoenap/2.jpg) ### 底噪测试 使用SMA Short将输入短接，测量10Hz 100kHz、10Hz 1MHz、10Hz Wideband输出端的噪声，分别为1.716mVrms、5.47mVrms、12.853mVrms。 由于器件差异和增益校准误差，底噪可能略有波动。 <center> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/nf_100k.PNG\" width \"80%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/nf_1m.PNG\" width \"80%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/nf_wide.PNG\" width \"80%\" border \"0\"/> </center> ## 测试案例 ### LT3042超低噪声LDO输出噪声测试 测量LT3042空载输出噪声（3.3V DC），10Hz 100kHz、10Hz 1MHz分别为0.673uVrms、1.057uVrms： <div style \"display: flex; justify content: center; align items: center;\"> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/3042_100k.PNG\" width \"50%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/3042_1m.PNG\" width \"50%\" border \"0\"/> </div> 指标来看是满足其数据手册规格的。因为LDO输出侧接有MLCC电容，使得 **DUT对震动异常敏感**。手接近PCB时都会引起输出大幅度跳动。**测试时需要注意屏蔽和隔震措施**。 ### TPS7A4901低噪声LDO输出噪声测试 测量TPS7A4901空载输出噪声（3.3V DC），1ms/div时，10Hz 100kHz为10.6uVrms；200ms/div时，10Hz 100kHz为12.4uVrms。这是因为1ms/div时采不到极低频噪声，所以读数偏小。 <div style \"display: flex; justify content: center; align items: center;\"> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/4901_100k.PNG\" width \"50%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/4901_1m.PNG\" width \"50%\" border \"0\"/> </div> 4901的噪声水平符合手册指标。从4901的手册中截取输出噪声谱密度曲线如下，在10Hz 1k段、10k 100k段有明显的陡降，FFT观测与此相符。 <center> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/4901_ds.PNG\" width \"80%\" border \"0\"/> </center> ### LM399基准电压源输出噪声测试 时基1ms/div测试10Hz 100kHz噪声为48.6uVrms <div style \"display: flex; justify content: center; align items: center;\"> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/399_100k.png\" width \"50%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/399_ds.png\" width \"50%\" border \"0\"/> </div> LM399手册给出的10Hz 10kHz带宽噪声为7uVrms（典型值），最大50uVrms。Zener加热稳定后的噪声水平比常温下高，可以从噪声密度谱曲线看出，10Hz 100k段噪声除开1/f成分，基本是平坦的。可以根据10Hz 10kHz带宽的噪声水平估计100k带宽，乘以√10即可，测量结果在手册指标范围内。 ### ADR1399基准电压源输出噪声测试 时基100ms/div测试10Hz 100kHz噪声、测试10Hz 1MHz噪声分别为23uVrms、46.7uVrms。 <div style \"display: flex; justify content: center; align items: center;\"> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/1399_100k.PNG\" width \"50%\" border \"0\"/> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/1399_1m.PNG\" width \"50%\" border \"0\"/> </div> 100k带宽的结果是可信的，**但1MHz带宽的测量结果不是那么可信**，因为这个EVM上用了一个隔离的DC DC LTM模组，开关频率约为500kHz，在隔离输出侧的滤波措施并不好，因此污染了基准的输出。在100kHz档位测试时，此ripple成分对总噪声值贡献较少，不影响测试结果（因为有100k的低通滤波器），但在1MHz档位时，此纹波位于通带内，占据了噪声的主要成分，所以读数不可信。 我们再看看100k带宽测试时的输出信号FFT频谱成分，可以看到500k左右的开关纹波被低通滤波器衰减了很多，低于噪声电压水平，对测试结果影响不是那么大。（这里测量项的平均值忘了清空了，当前值215.68是准确的） <center> <img src \"https://emoe blog.oss cn hangzhou.aliyuncs.com/article_img/%E5%99%AA%E5%A3%B0%E6%94%BE%E5%A4%A7%E5%99%A8 %E9%87%8F%E5%8C%96%E5%AF%82%E9%9D%99/1399_100k_r.PNG\" width \"80%\" border \"0\"/> </center> ## 参考链接 [噪声放大器构建指南](https://www.emoe.xyz/noise amplifier building instruction/) [噪声放大器进阶指南](https://www.emoe.xyz/noise amplifier step further/) [噪声放大器 量化寂静](https://www.emoe.xyz/emoenap quantifying silence/) [运算放大器噪声分析](https://www.emoe.xyz/opamp noise analyze/) 此产品原理图开源，链接如下： [Github Emoe R&D](https://github.com/emoestudio/EmoeNAP) ## 鸣谢 Linear Technology Analog Devices Inc Emoe R&D ## 修订历史 2024.1.31 初版发布（v1.0） 2024.2.27 增加图片，部分内容修订"},"/projects/EmoeDAQ/emoedaq.html":{"title":"","content":"# EmoeDAQ高精度数据采集器"},"/projects/EmoeDAQ/emoedaq-spec.html":{"title":"EmoeDAQ Datasheet","content":" title: EmoeDAQ Datasheet keywords: EmoeDAQ desc: EmoeDAQ Datasheet author: Floydfish date: false tags: analog, emoedaq # EmoeDAQ 数据手册 EmoeDAQ是一款双通道、全差分输入的精密数据采集卡，具有±4.95V输入范围和24bit/32bit分辨率（24bit下，1 LSB等于0.6uV），同时具有极低的Noise Floor、极高的输入阻抗、低输入偏置电流，非常适合用于精密直流数据采集应用。 > 硬件版本： 1.4.0 > 手册版本： 1.0.5 > 最后更新时间： 2025 03 28 ## EmoeDAQ特性概览 测量端与数据接口全电气隔离，耐压1.5kV，浮地测量 2个全差分输入通道，双极性电压测量，差分输入范围±4.95V 采样积分周期从NPLC 100至NPLC 0.1可调(非连续可调) 高达22bit无噪声分辨率（同量程范围下，6½数字万用表同等级指标） 校准后最大积分非线性误差（INL）为 **±3.5ppm**（7ppm Peak to Peak，以34465A的10V档为参考） 基准老化性能为25ppm/khr，出厂的DAQ均经过3周早期老化 内部主动加热恒温设计，恒温温度一定范围内可调 采样率500Hz时，THD< 100dB 支持内部失调实时补偿 短期稳定性（24小时）等同于6½数字万用表水平 支持用户自定义校准 兼容标准SCPI指令集 ## EmoeDAQ典型应用 电压输出型传感器数据采集 精密电压测量与长时间观测 1/f噪声测量 自定义设备的模拟采集核心 极低频交流信号精密分析 自定义测试系统组件 搭配Emoe R&D提供的开源选件，可实现如下应用： 精密RTD/热电偶温度测量（RTD/热电偶选件） 双向高/低边电流测量（检流电阻、INA选件） 超宽动态范围I V变换电流测量（与EmoeFemto搭配使用） 超低噪声小信号测量，nV Meter（nV Meter前端选件） 多通道电信号扫描测量（扫描卡选件） 更多选件仍在开发中，也欢迎在我们的github organization仓库发起讨论，一起开发新玩法。 ## 物理接口与标识 外壳尺寸100mm / 66mm / 27mm（长宽高），与EmoeNAP相同大小 后面板： Type C，用于供电+USB VCP串口通信，以及DFU固件升级 SCPI通信错误状态指示LED、内部温度状态指示LED 前面板： 8PIN 2.54mm间距插拔接线端子（KF 2.54），用于输入全差分模拟信号 2*3PIN 2.54mm牛角座，用于内部低噪声稳压电源输出，对外I2C接口（连接选件） 输入过载指示灯（差分电压大于5V时，亮红灯） 电源 USB端口供电，电压为+5V±5% ## 通信与协议 通过USB VCP（Virtual COM Port）与PC通信 兼容标准SCPI指令集，同时DAQ部分兼容ADI的ADMX3652模块指令集 ## 测量端参数 测量端与供电端电气隔离（绝缘等级1.5kV），可实现真正的浮地测量 每个输入端输入阻抗>10GΩ，输入偏置电流＜300pA（+2.5V/ 2.5V输入下） 全差分输入测量范围为 4.95V至+4.95V（常用的单端测量接法是将IN 接GND，IN+接输入电压） 输入端极限过载电压为±9V，内部设有气体放电管及PTC熔丝用于过载保护（长时间过载将损坏前端，不建议在信号幅度超出输入范围的场合使用） ## 规格表 指标 备注(测试条件) 输入阻抗 10GΩ> 输入信号在输入范围内 输入漏电流 <200pA 输入信号在输入范围内 可用输入测量范围 4.95V ~ +4.95V 可精确测量范围(受基准精度限制) 系统无噪声分辨率 22bit EmoeDAQ 24版 系统非线性度(INL) ±3.5ppm 典型值,以34465A的10V档(标称1ppm)为基准 电压回读分辨率 提供小数点后8位数字，稳定至后6位(1uV) NPLC 10，DAQ通电稳定后 基准老化性能 25ppm/1000 hours, 51ppm/4500hours 典型值，制造商保证 系统温度系数 TBD TBD 24小时稳定性 TBD TBD CMRR DC典型值: 106dB NPLC 10 扫描转换通道间隔离度 DC典型值: 114dB NPLC 10 DC典型值: 95.4dB NPLC 1 DC典型值: 78.4dB NPLC 0.1 交流动态范围 > 150dB NPLC 0.1 推荐校准周期 3 month 3个月不掉电使用情况下 推荐恒温温度 35°C 室温25°C下 ## 部分详细测试数据 测试仪器： Keysight 34465A Keysight 34420A Yokogawa 7651 ADR1000 PWM Reference EmoeCalibrator ### 输入对地短接失调与噪声 ![zero_noise](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/EmoeDAQ/zero_offset.png) 测试对象为EmoeDAQ 24，温度稳定后，读数仅有2个LSB的跳动。 ### 上电后内部温升曲线 ![temp_rise](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/EmoeDAQ/temp_rise.png) 测试时室温15度，上电后约15分钟达到设定的加热温度 ### 交流噪声 ![ac_noise](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/EmoeDAQ/AC_NoiseFloor.png) 测试对象为EmoeDAQ 24，NPLC 0.1,采集50000个数据点后导出csv文件，使用numpy分析FFT。 ### 校准后非线性度测试 ![INL_Test](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/EmoeDAQ/inl_vs34420.png) 使用7651作为DC源，34465A作为参考表对2个DAQ进行INL校准，校准后测试DAQ的INL曲线如上图(2个DAQ均为EmoeDAQ 24) ### 24小时短期稳定性与多单元一致性测试 ![24h_test](https://emoe blog.oss cn hangzhou.aliyuncs.com/emoerd/EmoeDAQ/daq_vs_34420_24h.png) 使用以ADR1000为基准的PWM基准源，输出1V为4个设备的公共输入，以34420的1V档位测量值为参考，测试3个DAQ的数据，3个DAQ中DAQ1内部恒温开启，DAQ2和3未开启。测试时间24小时。 可以看出开启了内部恒温的DAQ1读数与34420的读数趋势几乎相同，只存在失调误差；DAQ2和DAQ3的一致性非常好，但是相对于34420的读数而言，稳定性不佳。可见使用温度控制的重要性。"}}